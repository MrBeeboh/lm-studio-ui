{
  "ui": {
    "top_bar": {
      "all_buttons": ["Open menu (mobile)", "ATOM Arena brand", "Layout Cockpit", "Layout Arena", "Panels 1", "Panels 2", "Panels 3", "Panels 4", "PresetSelect", "UiThemeSelect", "ThemeToggle", "LM Studio status"],
      "all_pills": ["Internet Access (Judge) OFF", "Internet Access (Judge) ON", "N questions (when built)"],
      "toggles": ["Internet Access (Judge) OFF/ON", "Web search globe", "Web search None/All"],
      "inputs": ["Question dropdown (Q1 of N with preview)"],
      "default_states": {
        "arenaPanelCount": 1,
        "arenaBuilderInternetEnabled": false,
        "arenaWebSearchMode": "all",
        "sidebarCollapsed": "persisted",
        "layout": "arena when dashboard selected"
      }
    },
    "horizontal_control_bar": {
      "all_buttons": ["OFF (Internet Access Judge)", "ON (Internet Access Judge)", "Build Arena", "Previous question", "Next question", "Ask", "Next", "Run All or Stop", "Web globe", "None (web)", "All (web)", "Start Over"],
      "all_pills": ["Internet Access (Judge) label", "N questions pill when built"],
      "toggles": ["Internet Access (Judge) OFF/ON", "Web search None/All"],
      "inputs": ["Question select (value currentQuestionNum)"],
      "default_states": {
        "builtQuestionCount": 0,
        "currentQuestionTotal": 0,
        "runAllActive": false
      }
    },
    "left_panel": {
      "sections": ["Arena mode notice", "New chat", "Settings", "Conversations list", "Bulk erase"],
      "controls": ["+ New chat button", "Settings button", "Conversation items", "Bulk erase button", "Panel tab expand/collapse"],
      "state_fields": ["sidebarOpen", "sidebarCollapsed", "activeConversationId", "conversations"]
    },
    "right_panel": {
      "sections": ["Arena Builder", "Judge instructions", "Judge feedback", "Contest rules (accordion)", "Execution", "Judge model", "Score breakdown", "Actions"],
      "controls": ["Categories textarea (arena-builder-categories)", "Number of questions input (arena-builder-count)", "buildArenaError display", "Judge instructions textarea", "Judge feedback textarea", "Contest rules toggle and textarea", "Blind review checkbox", "Deterministic judge checkbox", "Judge model select", "ArenaScoreMatrix", "Reset all scores button", "Eject all models button", "Panel tab collapse"],
      "state_fields": ["arenaBuilderCategories", "arenaBuilderQuestionCount", "buildArenaError", "judgeInstructions", "judgeFeedback", "settingsRulesExpanded", "contestRules", "arenaSettingsCollapsed"]
    },
    "results_modal": {
      "fields_displayed": ["Scores title", "Per-slot score cards (Model A/B/C/D with score and explanation)", "Raw explanation block", "questionIndex", "scores", "explanations"],
      "export_buttons": ["Copy JSON", "Copy CSV", "Copy run metadata"],
      "copy_buttons": ["Copy JSON (results as JSON)", "Copy CSV (questionIndex slot score explanation)", "Copy run metadata (when arenaCurrentRunMeta exists)", "Close"]
    }
  },
  "contestant_configuration": {
    "max_slots": 4,
    "how_slots_are_selected": "User assigns model per slot via ModelSelectorSlot in header; dashboardModelA/B/C/D stores; slots active by arenaPanelCount (1-4)",
    "default_enabled_slots": ["A"],
    "slot_properties": ["modelId", "messages", "running", "slotError", "tps", "score", "standingLabel", "effectiveSettings", "optionsOpen"],
    "temperature_handling": "Per-slot from getSettingsForSlot(slot): mergeEffectiveSettings(globalDefault getEffectiveSettingsForModel modelId arenaSlotOverrides); temperature passed to streamChatCompletion in sendToSlot",
    "model_loading_logic": "Sequential one at a time: unloadAllModelsNative at run start; load first contestant; for each slot sendToSlot then unloadModel(slot) waitUntilUnloaded then loadModel(next); after last unload judge loads for scoring then unloads"
  },
  "arena_execution_flow": {
    "build_phase": {
      "exists": true,
      "steps": ["User sets categories and question count in right panel", "User toggles Internet Access (Judge) ON or OFF on bar", "User clicks Build Arena", "unloadAllModelsNative", "loadModel(judgeId) from pickJudgeModel", "If Internet ON: searchDuckDuckGo for categories query formatSearchResultForChat urls logged", "buildArenaQuestionGenerationPrompt with categories questionCount webContext", "requestChatCompletion judge temperature 0.6 max_tokens 8192", "parseGeneratedQuestionSet(content)", "builtQuestionSet and builtQuestionSetMeta set (run_id tool_calls urls_accessed timestamps)", "questionIndex 0", "unloadModel(judgeId) waitUntilUnloaded"]
    },
    "question_source": {
      "static_or_dynamic": "dynamic",
      "where_questions_come_from": "Built set from Build Arena phase only; builtQuestionSet.questions and builtQuestionSet.answers; no questions until Build Arena succeeds",
      "answer_key_source": "builtQuestionSet.answers indexed by questionIndex; currentQuestionAnswer derived from parsedAnswers[questionIndex]"
    },
    "contestant_phase": {
      "load_sequence": "unloadAllModelsNative then waitUntilUnloaded(loadedBefore 25s); load first selected contestant; for each slot after sendToSlot unload current then load next",
      "unload_sequence": "After each sendToSlot unloadModel(s.modelId) waitUntilUnloaded 15s; after last contestant unload before loading judge",
      "retry_logic": "maxAttempts 2 per slot; on failure setSlotError and push to failedSlots; continue to next slot",
      "timeout_logic": "ARENA_TIMEOUT_MS 120000; setTimeout controller.abort in sendToSlot; on AbortError return undefined and sanitize partial content",
      "memory_verification_logic": "getLoadedModelKeys after unloadAllModelsNative; waitUntilUnloaded(loadedBefore pollIntervalMs 400 timeoutMs 25000)"
    },
    "judge_phase": {
      "blind_review": "Controlled by arenaBlindReview store; when true buildJudgePromptBlind used and shuffleArray(slotsWithResponses shuffleRandom) with makeSeededRandom(arenaCurrentRunMeta.seed)",
      "shuffle_logic": "shuffleArray(slotsWithResponses shuffleRandom) in buildJudgePromptBlind; responseOrder returned; parseBlindJudgeScores maps Response N to slot via responseOrder",
      "temperature_used": "useDeterministicJudge ? 0 : judgeOpts.temperature from getSettingsForSlot A",
      "prompt_builder_function": "buildJudgePrompt or buildJudgePromptBlind in arenaLogic.js",
      "score_parser_function": "parseBlindJudgeScores when blind else parseJudgeScores; parseJudgeScoresAndExplanations for Copy JSON explanations",
      "failure_behavior": "On parse failure judgmentPopup with scores {} explanation raw output chatError set console.error; on catch err judgmentPopup with Scoring failed message and raw output chatError set console.error; finally clearTimeout judgeTimeoutId unload judge waitUntilUnloaded"
    }
  },
  "data_and_state": {
    "local_storage_keys": ["arenaSetupExpanded", "arenaContestRules", "arenaBuilderCategories", "arenaBuilderQuestionCount", "arenaSettingsCollapsed", "arenaJudgeInstructions", "arenaScores", "arenaPanelWidths", "arenaScoreHistory", "arenaPanelCount", "arenaSlotAIsJudge", "arenaWebSearchMode", "arenaScoringModelId", "arenaBlindReview", "arenaDeterministicJudge", "arenaBuilderInternetEnabled", "arenaSlotOverrides", "arenaQuestionPanelPos", "arenaQuestionPanelSize"],
    "in_memory_structures": ["builtQuestionSet", "builtQuestionSetMeta", "parsedQuestions", "parsedAnswers", "questionIndex", "scoreHistory", "arenaScores", "arenaCurrentRunMeta", "judgmentPopup", "messagesA/B/C/D", "running", "slotErrors", "aborters", "contestRules", "judgeFeedback", "judgeInstructions", "arenaTransitionPhase", "optionsOpenSlot", "settingsRulesExpanded", "panelWidths"],
    "run_metadata_fields": ["run_id", "seed", "question_index", "prompt_text", "model_list", "judge_model", "deterministic_judge", "blind_review", "start_timestamp", "responses"],
    "logging_behavior": "Console log Arena run start run_id seed question_index; console log Arena run metadata with run_id seed question_index deterministic_judge blind_review model_list judge_model responses scores; console error Arena judge_failure on parse failure or catch with raw_output run_id; Build Arena stores builtQuestionSetMeta with run_id tool_calls urls_accessed timestamps"
  },
  "files_and_modules": {
    "core_files": ["src/App.svelte", "src/lib/components/DashboardArena.svelte", "src/lib/components/ArenaControlBar.svelte", "src/lib/components/ArenaHeader.svelte", "src/lib/components/ArenaPanel.svelte", "src/lib/components/ArenaScoreMatrix.svelte", "src/lib/arenaLogic.js", "src/lib/stores.js", "src/lib/api.js", "src/lib/duckduckgo.js"],
    "arena_logic_functions": ["parseQuestionsAndAnswers", "migrateOldQuestionsAndAnswers", "stripThinkBlocks", "sanitizeContestantResponse", "parseJudgeScores", "parseJudgeScoresAndExplanations", "detectLoop", "loadScoreHistory", "saveScoreHistory", "addScoreRound", "computeTotals", "clearScoreHistory", "contentToText", "makeSeededRandom", "shuffleArray", "parseBlindJudgeScores", "buildJudgePrompt", "buildJudgePromptBlind", "buildArenaQuestionGenerationPrompt", "parseGeneratedQuestionSet", "pickJudgeModel", "arenaStandingLabel"],
    "utility_functions": ["generateId", "resizeImageDataUrlsForVision", "shouldSkipImageResizeForVision", "getEffectiveSettingsForModel", "mergeEffectiveSettings", "streamChatCompletion", "requestChatCompletion", "loadModel", "unloadModel", "unloadAllModelsNative", "waitUntilUnloaded", "getLoadedModelKeys", "searchDuckDuckGo", "formatSearchResultForChat", "warmUpSearchConnection"]
  },
  "feature_flags": {
    "blind_review": "arenaBlindReview store persisted localStorage arenaBlindReview default true; right panel Execution checkbox",
    "deterministic_judge": "arenaDeterministicJudge store persisted arenaDeterministicJudge default true; right panel Execution checkbox; when true judge temperature 0",
    "internet_access": "arenaBuilderInternetEnabled for Phase 1 Build Arena only persisted default false; arenaWebSearchMode none/all for judge scoring phase web context; webSearchForNextMessage for chat send",
    "other_flags": ["arenaPanelCount 1-4", "arenaScoringModelId or Auto", "arenaSlotOverrides per slot"]
  },
  "known_limitations": ["Question set only from Build Arena no manual paste", "Judge has no LM Studio tools; Internet ON injects our search into prompt", "Contestants never get internet unless globe and arenaWebSearchMode used for send", "One model loaded at a time during run", "ArenaQuestionPanel exists but is not used in DashboardArena"],
  "tests": {
    "test_files": ["src/lib/arenaLogic.spec.js"],
    "what_they_assert": ["parseQuestionsAndAnswers empty numbered Q/A JSON separate blocks plain list robustness", "parseJudgeScores format clamp think blocks", "parseJudgeScoresAndExplanations", "sanitizeContestantResponse Model X Response N think", "makeSeededRandom shuffleArray deterministic", "parseBlindJudgeScores responseOrder mapping", "buildJudgePromptBlind buildJudgePrompt answer key web custom instructions feedback", "stripThinkBlocks detectLoop contentToText", "arenaStandingLabel Leader 2nd 3rd 4th Tied", "addScoreRound computeTotals", "migrateOldQuestionsAndAnswers", "pickJudgeModel largest non-contestant user choice contestant fallback all contestants prefer instruct"],
    "currently_failing_tests": []
  }
}
