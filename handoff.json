{
  "project": "lm-studio-ui",
  "description": "Local LLM chat UI for LM Studio API. Two layouts: Cockpit (single chat) and Arena (multi-model competition with optional judge).",
  "stack": ["Svelte 5", "Vite", "Tailwind CSS", "LM Studio OpenAI-compatible API"],
  "handoffPurpose": "Context for a new agent/session. Read HANDOFF.md for narrative; this file gives structured references.",
  "layouts": {
    "cockpit": "Single-model chat. ChatView + ChatInput, attachments, voice, web search.",
    "arena": "2-4 models (B/C/D) answer same questions; slot A can be judge. Questions & answers in one block; Judgment scores 1-10; Ask the Judge for follow-up questions."
  },
  "keyFiles": {
    "App.svelte": "Root; switches layout by store.",
    "stores.js": "layout, dashboardModelA/B/C/D, arenaPanelCount, arenaSlotAIsJudge, arenaWebSearchMode, arenaSlotOverrides, webSearchForNextMessage, webSearchConnected, isStreaming, chatError, settings.",
    "DashboardArena.svelte": "Arena: model cards, control bar, panels, Judgment, Ask the Judge, Q&A parser, draggable/resizable question panel, settings panel. ~1900 lines.",
    "ChatView.svelte": "Cockpit chat + send + web search.",
    "ChatInput.svelte": "Input, attachments, voice, web globe.",
    "api.js": "streamChatCompletion, getModels, loadModel, unloadModel, waitUntilUnloaded, unloadAllLoadedModels.",
    "duckduckgo.js": "warmUpSearchConnection, searchDuckDuckGo, formatSearchResultForChat. CORS proxies.",
    "app.css": "Global + Arena bar dividers, globe, resize handles."
  },
  "arenaFeatures": [
    "Single Questions & answers text area (parseQuestionsAndAnswers; optional Answer: per question)",
    "Per-question answer for judge (currentQuestionAnswer); if blank, judge uses web or own knowledge",
    "Control bar: Question nav | Ask, Next | Web globe + None/All/Judge only | Judgment | Reset, Settings",
    "Judgment: eject models, load judge, prompt with competing list + current answer key + no-ramble instructions",
    "Ask the Judge: draggable panel, send user question to judge with context, show reply in panel",
    "Draggable question panel (position persisted); resizable (edges/corner, size persisted)",
    "Draggable Ask the Judge panel (position persisted)",
    "System prompt templates: Arena contestant, Arena judge (in ARENA_SYSTEM_PROMPT_TEMPLATES)"
  ],
  "arenaStateAndStorage": {
    "questionsAndAnswers": "Single source; localStorage key arenaQuestionsAndAnswers",
    "questionIndex": "Current question index (0-based)",
    "parsedQuestions": "Derived array of question strings",
    "parsedAnswers": "Derived array of answer strings (same length as parsedQuestions; may be '')",
    "currentQuestionAnswer": "parsedAnswers[questionIndex] trimmed; used in runJudgment and askTheJudge",
    "arenaQuestionPanelPos": "localStorage; { x, y } for question panel",
    "arenaQuestionPanelSize": "localStorage; { w, h } for question panel",
    "arenaAskJudgePanelPos": "localStorage; { x, y } for Ask the Judge panel",
    "arenaScores": "B, C, D scores; persisted"
  },
  "arenaJudgmentPromptLogic": {
    "competingSlots": "From slotsWithResponses (B/C/D with responses); exact list sent to judge",
    "answerKeyTrimmed": "Set to currentQuestionAnswer (answer for current question only)",
    "If answerKeyTrimmed empty": "Judge instructed to use web or own knowledge",
    "System message when answer key": "Reinforces 'only score lines', 'no <think>', exact model list"
  },
  "svelte5Notes": {
    "reactiveInEffect": "Use $storeName in $effect for reactivity; get(store) does not track",
    "messageRestoreOnSendFail": "ChatInput handleSubmit saves message, clears, then restores if onSend throws; ChatView/DashboardArena sendUserMessage must throw on error"
  },
  "searchHints": {
    "judgePromptText": "COMPETING MODELS, BASIS FOR SCORING, ANSWER KEY, systemWithAnswerKey in DashboardArena.svelte",
    "qAndAParser": "parseQuestionsAndAnswers, loadQuestionsAndAnswers, currentQuestionAnswer",
    "arenaBar": "arena-question-bar, arena-bar-section, arena-bar-divider",
    "dragResize": "makeDraggable, makeResizable, questionPanelPos, questionPanelSize"
  },
  "userPreferenceNote": "User prefers being challenged: never be afraid to push back or suggest a different approach when they ask for a better way."
}
